{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\yueyu\\\\OneDrive\\\\CardiIQ\\\\frontend\\\\src\\\\components\\\\CameraPPG.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport './CameraPPG.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CameraPPG = ({\n  duration = 30,\n  onComplete\n}) => {\n  _s();\n  const [isRecording, setIsRecording] = useState(false);\n  const [status, setStatus] = useState('idle');\n  const [ppgData, setPpgData] = useState([]);\n  const [lastSample, setLastSample] = useState(null);\n  const [snapshotUrl, setSnapshotUrl] = useState(null);\n  const [bypassBrightness, setBypassBrightness] = useState(false);\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const graphRef = useRef(null);\n  const rafRef = useRef(null);\n  const streamRef = useRef(null);\n  const frameCountRef = useRef(0);\n  const isRecordingRef = useRef(false);\n  useEffect(() => {\n    // Ensure the ref is in sync with the state\n    isRecordingRef.current = isRecording;\n  }, [isRecording]);\n  useEffect(() => {\n    return () => {\n      stopAll();\n    };\n  }, []);\n  const setStatusMsg = s => {\n    try {\n      setStatus(s);\n    } catch (e) {}\n  };\n  async function requestPermission() {\n    try {\n      setStatusMsg('requesting camera permission...');\n      const s = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: 'user',\n          width: {\n            ideal: 640\n          },\n          height: {\n            ideal: 480\n          }\n        },\n        audio: false\n      });\n      streamRef.current = s;\n      if (videoRef.current) {\n        videoRef.current.srcObject = s;\n        videoRef.current.onloadedmetadata = () => {\n          setStatusMsg('camera ready, click start');\n        };\n      }\n      setStatusMsg('camera permission granted');\n      return s;\n    } catch (err) {\n      console.error('permission error', err);\n      setStatusMsg('camera permission denied: ' + (err && err.name ? err.name : String(err)));\n      throw err;\n    }\n  }\n  async function attemptPlay() {\n    try {\n      if (!videoRef.current) return;\n      await videoRef.current.play();\n      setStatusMsg('video playing');\n    } catch (e) {\n      setStatusMsg('video play blocked - tap allowed');\n    }\n  }\n  async function startRecording() {\n    try {\n      setStatusMsg('starting...');\n      if (!streamRef.current) {\n        try {\n          await requestPermission();\n        } catch (err) {\n          return;\n        }\n      }\n      if (videoRef.current && !videoRef.current.srcObject && streamRef.current) {\n        videoRef.current.srcObject = streamRef.current;\n      }\n      videoRef.current.play().then(() => {\n        setStatusMsg('video playback started');\n        setIsRecording(true);\n        frameCountRef.current = 0;\n        setPpgData([]);\n\n        // Give it a moment for playback to stabilize before starting the loop\n        setTimeout(() => {\n          startLoop();\n        }, 300);\n      }).catch(e => {\n        setStatusMsg('playback failed, tap video to try');\n        console.error(\"Playback failed\", e);\n      });\n    } catch (err) {\n      console.error('startRecording error', err);\n      setStatusMsg('start error: ' + err.message);\n    }\n  }\n  function stopAll() {\n    setIsRecording(false);\n    if (rafRef.current) {\n      try {\n        cancelAnimationFrame(rafRef.current);\n      } catch (e) {}\n      rafRef.current = null;\n    }\n    if (streamRef.current) {\n      try {\n        streamRef.current.getTracks().forEach(t => t.stop());\n      } catch (e) {}\n      streamRef.current = null;\n    }\n    if (videoRef.current) {\n      try {\n        videoRef.current.srcObject = null;\n      } catch (e) {}\n    }\n    setStatusMsg('stopped');\n  }\n  function stopRecording() {\n    stopAll();\n    if (onComplete) onComplete(ppgData);\n  }\n  function extractAvgRed(ctx, w, h) {\n    try {\n      const cx = Math.floor(w / 2);\n      const cy = Math.floor(h / 2);\n      const sampleSize = Math.max(8, Math.floor(Math.min(50, Math.min(w, h) * 0.12)));\n      const sx = Math.max(0, Math.min(w - 1, Math.floor(cx - sampleSize / 2)));\n      const sy = Math.max(0, Math.min(h - 1, Math.floor(cy - sampleSize / 2)));\n      const sw = Math.max(1, Math.min(sampleSize, w - sx));\n      const sh = Math.max(1, Math.min(sampleSize, h - sy));\n      const data = ctx.getImageData(sx, sy, sw, sh).data;\n      let red = 0;\n      for (let i = 0; i < data.length; i += 4) red += data[i];\n      const avg = red / Math.max(1, data.length / 4);\n      if (!bypassBrightness && (avg < 30 || avg > 245)) return null;\n      return {\n        avg,\n        sx,\n        sy,\n        sw,\n        sh\n      };\n    } catch (e) {\n      return null;\n    }\n  }\n  function drawWaveform(dataArr) {\n    try {\n      const c = graphRef.current;\n      if (!c) return;\n      const ctx = c.getContext('2d');\n      const w = c.width;\n      const h = c.height;\n      ctx.clearRect(0, 0, w, h);\n      if (!dataArr || dataArr.length === 0) return;\n      const minV = Math.min(...dataArr);\n      const maxV = Math.max(...dataArr);\n      const range = Math.max(1e-6, maxV - minV);\n      ctx.strokeStyle = '#00c853';\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      const step = w / Math.max(1, dataArr.length - 1);\n      for (let i = 0; i < dataArr.length; i++) {\n        const v = (dataArr[i] - minV) / range;\n        const y = h - (10 + v * (h - 20));\n        const x = i * step;\n        if (i === 0) ctx.moveTo(x, y);else ctx.lineTo(x, y);\n      }\n      ctx.stroke();\n    } catch (e) {}\n  }\n  function startLoop() {\n    const canvas = canvasRef.current;\n    const video = videoRef.current;\n    if (!canvas || !video) {\n      setStatusMsg('error: video/canvas missing');\n      return;\n    }\n    const ctx = canvas.getContext('2d');\n    setStatusMsg('starting analysis loop...');\n    const step = () => {\n      try {\n        if (!isRecordingRef.current) {\n          // Use the ref here for immediate consistency\n          setStatusMsg('loop stopped.');\n          return;\n        }\n        if (video.readyState >= 2 && video.videoWidth > 0) {\n          canvas.width = video.videoWidth;\n          canvas.height = video.videoHeight;\n          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n          const sample = extractAvgRed(ctx, canvas.width, canvas.height);\n          if (sample) {\n            const scaled = sample.avg;\n            frameCountRef.current++;\n            setPpgData(prev => {\n              const next = prev.slice(-599);\n              next.push(scaled);\n              drawWaveform(next);\n              return next;\n            });\n            setLastSample(sample.avg);\n            setStatusMsg('recording... frames: ' + frameCountRef.current);\n            ctx.save();\n            ctx.strokeStyle = 'rgba(255,255,255,0.9)';\n            ctx.lineWidth = 2;\n            ctx.strokeRect(sample.sx, sample.sy, sample.sw, sample.sh);\n            ctx.restore();\n          } else {\n            setStatusMsg('cover camera lens completely');\n          }\n        } else {\n          setStatusMsg('waiting for video frames...');\n        }\n      } catch (e) {\n        console.warn('loop error', e);\n        setStatusMsg('analysis loop error');\n      }\n      rafRef.current = requestAnimationFrame(step);\n    };\n    rafRef.current = requestAnimationFrame(step);\n  }\n  function takeSnapshot() {\n    try {\n      const c = canvasRef.current;\n      if (!c) return;\n      const url = c.toDataURL('image/png');\n      setSnapshotUrl(url);\n      setStatusMsg('snapshot taken');\n    } catch (e) {\n      setStatusMsg('snapshot failed');\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"camera-ppg\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: 8\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"Status:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 37\n      }, this), \" \", status]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: videoRef,\n        className: \"ppg-video\",\n        playsInline: true,\n        muted: true,\n        onClick: attemptPlay,\n        style: {\n          display: 'none'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        className: \"ppg-canvas\",\n        style: {\n          display: 'block'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 12\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => requestPermission(),\n        style: {\n          marginRight: 8\n        },\n        children: \"Request Camera Permission\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 5\n      }, this), !isRecording ? /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => startRecording(),\n        style: {\n          marginRight: 8\n        },\n        children: \"Start Measurement\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 6\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => stopRecording(),\n        style: {\n          marginRight: 8\n        },\n        children: \"Stop\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: takeSnapshot,\n        style: {\n          marginRight: 8\n        },\n        children: \"Snapshot\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        style: {\n          marginLeft: 8\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"checkbox\",\n          checked: bypassBrightness,\n          onChange: e => setBypassBrightness(e.target.checked)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 38\n        }, this), \" Bypass brightness filter\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 12\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Live Metrics\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [\"Last sample: \", lastSample ? lastSample.toFixed(1) : '--']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: graphRef,\n        width: 600,\n        height: 140,\n        style: {\n          width: '100%',\n          height: 140,\n          background: '#fff',\n          borderRadius: 8,\n          border: '1px solid rgba(0,0,0,0.06)'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 4\n    }, this), snapshotUrl && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 12\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Snapshot\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n        src: snapshotUrl,\n        alt: \"snapshot\",\n        style: {\n          maxWidth: '100%'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 6\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 231,\n    columnNumber: 3\n  }, this);\n};\n_s(CameraPPG, \"0TFHsJImFJlpwv137GMgT0cZKng=\");\n_c = CameraPPG;\nexport default CameraPPG;\nvar _c;\n$RefreshReg$(_c, \"CameraPPG\");","map":{"version":3,"names":["React","useState","useRef","useEffect","jsxDEV","_jsxDEV","CameraPPG","duration","onComplete","_s","isRecording","setIsRecording","status","setStatus","ppgData","setPpgData","lastSample","setLastSample","snapshotUrl","setSnapshotUrl","bypassBrightness","setBypassBrightness","videoRef","canvasRef","graphRef","rafRef","streamRef","frameCountRef","isRecordingRef","current","stopAll","setStatusMsg","s","e","requestPermission","navigator","mediaDevices","getUserMedia","video","facingMode","width","ideal","height","audio","srcObject","onloadedmetadata","err","console","error","name","String","attemptPlay","play","startRecording","then","setTimeout","startLoop","catch","message","cancelAnimationFrame","getTracks","forEach","t","stop","stopRecording","extractAvgRed","ctx","w","h","cx","Math","floor","cy","sampleSize","max","min","sx","sy","sw","sh","data","getImageData","red","i","length","avg","drawWaveform","dataArr","c","getContext","clearRect","minV","maxV","range","strokeStyle","lineWidth","beginPath","step","v","y","x","moveTo","lineTo","stroke","canvas","readyState","videoWidth","videoHeight","drawImage","sample","scaled","prev","next","slice","push","save","strokeRect","restore","warn","requestAnimationFrame","takeSnapshot","url","toDataURL","className","children","style","marginBottom","fileName","_jsxFileName","lineNumber","columnNumber","ref","playsInline","muted","onClick","display","marginTop","marginRight","marginLeft","type","checked","onChange","target","toFixed","background","borderRadius","border","src","alt","maxWidth","_c","$RefreshReg$"],"sources":["C:/Users/yueyu/OneDrive/CardiIQ/frontend/src/components/CameraPPG.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport './CameraPPG.css';\r\n\r\nconst CameraPPG = ({ duration = 30, onComplete }) => {\r\n\tconst [isRecording, setIsRecording] = useState(false);\r\n\tconst [status, setStatus] = useState('idle');\r\n\tconst [ppgData, setPpgData] = useState([]);\r\n\tconst [lastSample, setLastSample] = useState(null);\r\n\tconst [snapshotUrl, setSnapshotUrl] = useState(null);\r\n\tconst [bypassBrightness, setBypassBrightness] = useState(false);\r\n\r\n\tconst videoRef = useRef(null);\r\n\tconst canvasRef = useRef(null);\r\n\tconst graphRef = useRef(null);\r\n\tconst rafRef = useRef(null);\r\n\tconst streamRef = useRef(null);\r\n\tconst frameCountRef = useRef(0);\r\n\r\n\tconst isRecordingRef = useRef(false);\r\n\r\n\tuseEffect(() => {\r\n\t\t// Ensure the ref is in sync with the state\r\n\t\tisRecordingRef.current = isRecording;\r\n\t}, [isRecording]);\r\n\r\n\tuseEffect(() => {\r\n\t\treturn () => {\r\n\t\t\tstopAll();\r\n\t\t};\r\n\t}, []);\r\n\r\n\tconst setStatusMsg = (s) => {\r\n\t\ttry { setStatus(s); } catch (e) {}\r\n\t};\r\n\r\n\tasync function requestPermission() {\r\n\t\ttry {\r\n\t\t\tsetStatusMsg('requesting camera permission...');\r\n\t\t\tconst s = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user', width: { ideal: 640 }, height: { ideal: 480 } }, audio: false });\r\n\t\t\tstreamRef.current = s;\r\n\t\t\tif (videoRef.current) {\r\n\t\t\t\tvideoRef.current.srcObject = s;\r\n\t\t\t\tvideoRef.current.onloadedmetadata = () => {\r\n\t\t\t\t\tsetStatusMsg('camera ready, click start');\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tsetStatusMsg('camera permission granted');\r\n\t\t\treturn s;\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error('permission error', err);\r\n\t\t\tsetStatusMsg('camera permission denied: ' + (err && err.name ? err.name : String(err)));\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\tasync function attemptPlay() {\r\n\t\ttry {\r\n\t\t\tif (!videoRef.current) return;\r\n\t\t\tawait videoRef.current.play();\r\n\t\t\tsetStatusMsg('video playing');\r\n\t\t} catch (e) {\r\n\t\t\tsetStatusMsg('video play blocked - tap allowed');\r\n\t\t}\r\n\t}\r\n\r\n\tasync function startRecording() {\r\n\t\ttry {\r\n\t\t\tsetStatusMsg('starting...');\r\n\t\t\tif (!streamRef.current) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tawait requestPermission();\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (videoRef.current && !videoRef.current.srcObject && streamRef.current) {\r\n\t\t\t\tvideoRef.current.srcObject = streamRef.current;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvideoRef.current.play().then(() => {\r\n\t\t\t\tsetStatusMsg('video playback started');\r\n\t\t\t\tsetIsRecording(true);\r\n\t\t\t\tframeCountRef.current = 0;\r\n\t\t\t\tsetPpgData([]);\r\n\t\t\t\t\r\n\t\t\t\t// Give it a moment for playback to stabilize before starting the loop\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tstartLoop();\r\n\t\t\t\t}, 300);\r\n\r\n\t\t\t}).catch(e => {\r\n\t\t\t\tsetStatusMsg('playback failed, tap video to try');\r\n\t\t\t\tconsole.error(\"Playback failed\", e);\r\n\t\t\t});\r\n\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error('startRecording error', err);\r\n\t\t\tsetStatusMsg('start error: ' + err.message);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction stopAll() {\r\n\t\tsetIsRecording(false);\r\n\t\tif (rafRef.current) {\r\n\t\t\ttry { cancelAnimationFrame(rafRef.current); } catch (e) {}\r\n\t\t\trafRef.current = null;\r\n\t\t}\r\n\t\tif (streamRef.current) {\r\n\t\t\ttry {\r\n\t\t\t\tstreamRef.current.getTracks().forEach(t => t.stop());\r\n\t\t\t} catch (e) {}\r\n\t\t\tstreamRef.current = null;\r\n\t\t}\r\n\t\tif (videoRef.current) {\r\n\t\t\ttry { videoRef.current.srcObject = null; } catch (e) {}\r\n\t\t}\r\n\t\tsetStatusMsg('stopped');\r\n\t}\r\n\r\n\tfunction stopRecording() {\r\n\t\tstopAll();\r\n\t\tif (onComplete) onComplete(ppgData);\r\n\t}\r\n\r\n\tfunction extractAvgRed(ctx, w, h) {\r\n\t\ttry {\r\n\t\t\tconst cx = Math.floor(w / 2);\r\n\t\t\tconst cy = Math.floor(h / 2);\r\n\t\t\tconst sampleSize = Math.max(8, Math.floor(Math.min(50, Math.min(w, h) * 0.12)));\r\n\t\t\tconst sx = Math.max(0, Math.min(w - 1, Math.floor(cx - sampleSize / 2)));\r\n\t\t\tconst sy = Math.max(0, Math.min(h - 1, Math.floor(cy - sampleSize / 2)));\r\n\t\t\tconst sw = Math.max(1, Math.min(sampleSize, w - sx));\r\n\t\t\tconst sh = Math.max(1, Math.min(sampleSize, h - sy));\r\n\t\t\tconst data = ctx.getImageData(sx, sy, sw, sh).data;\r\n\t\t\tlet red = 0;\r\n\t\t\tfor (let i = 0; i < data.length; i += 4) red += data[i];\r\n\t\t\tconst avg = red / Math.max(1, data.length / 4);\r\n\t\t\tif (!bypassBrightness && (avg < 30 || avg > 245)) return null;\r\n\t\t\treturn { avg, sx, sy, sw, sh };\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction drawWaveform(dataArr) {\r\n\t\ttry {\r\n\t\t\tconst c = graphRef.current;\r\n\t\t\tif (!c) return;\r\n\t\t\tconst ctx = c.getContext('2d');\r\n\t\t\tconst w = c.width;\r\n\t\t\tconst h = c.height;\r\n\t\t\tctx.clearRect(0, 0, w, h);\r\n\t\t\tif (!dataArr || dataArr.length === 0) return;\r\n\t\t\tconst minV = Math.min(...dataArr);\r\n\t\t\tconst maxV = Math.max(...dataArr);\r\n\t\t\tconst range = Math.max(1e-6, maxV - minV);\r\n\t\t\tctx.strokeStyle = '#00c853';\r\n\t\t\tctx.lineWidth = 2;\r\n\t\t\tctx.beginPath();\r\n\t\t\tconst step = w / Math.max(1, dataArr.length - 1);\r\n\t\t\tfor (let i = 0; i < dataArr.length; i++) {\r\n\t\t\t\tconst v = (dataArr[i] - minV) / range;\r\n\t\t\t\tconst y = h - (10 + v * (h - 20));\r\n\t\t\t\tconst x = i * step;\r\n\t\t\t\tif (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);\r\n\t\t\t}\r\n\t\t\tctx.stroke();\r\n\t\t} catch (e) {}\r\n\t}\r\n\r\n\tfunction startLoop() {\r\n\t\tconst canvas = canvasRef.current;\r\n\t\tconst video = videoRef.current;\r\n\t\tif (!canvas || !video) {\r\n\t\t\tsetStatusMsg('error: video/canvas missing');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst ctx = canvas.getContext('2d');\r\n\t\tsetStatusMsg('starting analysis loop...');\r\n\r\n\t\tconst step = () => {\r\n\t\t\ttry {\r\n\t\t\t\tif (!isRecordingRef.current) { // Use the ref here for immediate consistency\r\n\t\t\t\t\tsetStatusMsg('loop stopped.');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (video.readyState >= 2 && video.videoWidth > 0) {\r\n\t\t\t\t\tcanvas.width = video.videoWidth;\r\n\t\t\t\t\tcanvas.height = video.videoHeight;\r\n\t\t\t\t\tctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\t\t\t\t\tconst sample = extractAvgRed(ctx, canvas.width, canvas.height);\r\n\t\t\t\t\tif (sample) {\r\n\t\t\t\t\t\tconst scaled = sample.avg;\r\n\t\t\t\t\t\tframeCountRef.current++;\r\n\t\t\t\t\t\tsetPpgData(prev => {\r\n\t\t\t\t\t\t\tconst next = prev.slice(-599);\r\n\t\t\t\t\t\t\tnext.push(scaled);\r\n\t\t\t\t\t\t\tdrawWaveform(next);\r\n\t\t\t\t\t\t\treturn next;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tsetLastSample(sample.avg);\r\n\t\t\t\t\t\tsetStatusMsg('recording... frames: ' + frameCountRef.current);\r\n\t\t\t\t\t\tctx.save(); ctx.strokeStyle = 'rgba(255,255,255,0.9)'; ctx.lineWidth = 2; ctx.strokeRect(sample.sx, sample.sy, sample.sw, sample.sh); ctx.restore();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsetStatusMsg('cover camera lens completely');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetStatusMsg('waiting for video frames...');\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.warn('loop error', e);\r\n\t\t\t\tsetStatusMsg('analysis loop error');\r\n\t\t\t}\r\n\t\t\trafRef.current = requestAnimationFrame(step);\r\n\t\t};\r\n\t\trafRef.current = requestAnimationFrame(step);\r\n\t}\r\n\r\n\tfunction takeSnapshot() {\r\n\t\ttry {\r\n\t\t\tconst c = canvasRef.current;\r\n\t\t\tif (!c) return;\r\n\t\t\tconst url = c.toDataURL('image/png');\r\n\t\t\tsetSnapshotUrl(url);\r\n\t\t\tsetStatusMsg('snapshot taken');\r\n\t\t} catch (e) { setStatusMsg('snapshot failed'); }\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"camera-ppg\">\r\n\t\t\t<div style={{ marginBottom: 8 }}><strong>Status:</strong> {status}</div>\r\n\r\n\t\t\t<div className=\"video-container\">\r\n\t\t\t\t<video ref={videoRef} className=\"ppg-video\" playsInline muted onClick={attemptPlay} style={{ display: 'none' }} />\r\n\t\t\t\t<canvas ref={canvasRef} className=\"ppg-canvas\" style={{ display: 'block' }} />\r\n\t\t\t</div>\r\n\r\n\t\t\t<div style={{ marginTop: 12 }}>\r\n\t\t\t\t<button onClick={() => requestPermission()} style={{ marginRight: 8 }}>Request Camera Permission</button>\r\n\t\t\t\t{!isRecording ? (\r\n\t\t\t\t\t<button onClick={() => startRecording()} style={{ marginRight: 8 }}>Start Measurement</button>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<button onClick={() => stopRecording()} style={{ marginRight: 8 }}>Stop</button>\r\n\t\t\t\t)}\r\n\t\t\t\t<button onClick={takeSnapshot} style={{ marginRight: 8 }}>Snapshot</button>\r\n\t\t\t\t<label style={{ marginLeft: 8 }}><input type=\"checkbox\" checked={bypassBrightness} onChange={(e) => setBypassBrightness(e.target.checked)} /> Bypass brightness filter</label>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div style={{ marginTop: 12 }}>\r\n\t\t\t\t<h4>Live Metrics</h4>\r\n\t\t\t\t<div>Last sample: {lastSample ? lastSample.toFixed(1) : '--'}</div>\r\n\t\t\t\t<canvas ref={graphRef} width={600} height={140} style={{ width: '100%', height: 140, background: '#fff', borderRadius: 8, border: '1px solid rgba(0,0,0,0.06)' }} />\r\n\t\t\t</div>\r\n\r\n\t\t\t{snapshotUrl && (\r\n\t\t\t\t<div style={{ marginTop: 12 }}>\r\n\t\t\t\t\t<h4>Snapshot</h4>\r\n\t\t\t\t\t<img src={snapshotUrl} alt=\"snapshot\" style={{ maxWidth: '100%' }} />\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default CameraPPG;\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}